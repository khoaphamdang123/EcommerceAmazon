 
 @model List<CartModel>
 @using System.Globalization;
 @inject IHttpContextAccessor HttpContextAccessor
 @using System.Text.RegularExpressions;
 @{
    Layout="_UserLayout";
    @* var user=ViewBag.user as ApplicationUser;
    var company_user=  ViewBag.company as ApplicationUser;
    var payment_methods=ViewBag.payment_methods as List<Payment>;
    Console.WriteLine(payment_methods.Count); *@
    int total_value=0;
    var siteKey=ViewBag.SiteKey;
    var message_checkout=ViewBag.Message;
    var status_checkout = ViewBag.Status;
    var account= ViewBag.Account;
    var saved_account= ViewBag.SavedAccount;
    string paypal_client_id=Environment.GetEnvironmentVariable("PAYPAL_CLIENT_ID");
     string username="";
     string password="";

     var payment_methods=ViewBag.payment_methods as List<Payment>;

   string card_number=HttpContextAccessor.HttpContext.Session.GetString("CardNumber");
   string card_owner=HttpContextAccessor.HttpContext.Session.GetString("CardOwner"); 
   string mm=HttpContextAccessor.HttpContext.Session.GetString("MM");
   string yy=HttpContextAccessor.HttpContext.Session.GetString("YY");
   string cvv=HttpContextAccessor.HttpContext.Session.GetString("CVV");
 

      double total_amount=0;
    double total_delivery=Model.Count>0?5:0;
    foreach(var item in Model)
    {
        double discount=string.IsNullOrEmpty(item.Product.Discount.ToString()) ? 0 : Convert.ToInt32(item.Product.Discount);
        
        string price_value=!string.IsNullOrEmpty(item.Price) ? item.Price : item.Product.Price;
        
        price_value=price_value.Replace("$","").Replace(",",".");
        
        double current_price=(double.Parse(price_value,CultureInfo.InvariantCulture)-(double.Parse(price_value,CultureInfo.InvariantCulture)*(discount)/100));
        
        total_amount+=current_price*item.Quantity;           
    }

    Console.WriteLine("Sitekey here is:"+siteKey);     
 } 
 @if(status_checkout==0)
 {
 <div
       class="bs-toast toast fade hide bg-danger toast-placement-ex top-5 end-0"
       role="alert"
       aria-live="assertive"
       aria-atomic="true"
        data-bs-dismiss="toast"
        style="cursor: pointer;"
         data-delay="3000"
         data-bs-autohide="true" 
         data-bs-delay="3000"
             >
                        <div class="toast-header">
                          <i class="bx bx-bell me-2"></i>
                          <div class="me-auto fw-semibold">Đặt hàng</div>
                        </div>
                        <div class="toast-body">
                         @(message_checkout)                         
                        </div>
                      </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() 
            {
                var toastEl = document.querySelector('.toast');
                var toast = new bootstrap.Toast(toastEl);
                toast.show();                
            });
        </script>        
        }

@Html.AntiForgeryToken()        
  
  <div
       class="bs-toast toast fade hide toast-placement-ex top-5 end-0"
       role="alert"
       aria-live="assertive"
       aria-atomic="true"       
       data-bs-dismiss="toast"
       style="cursor: pointer; position: fixed; top: 20px; right: 20px; z-index: 1050;"
       data-delay="3000"
       data-bs-autohide="true" 
       data-bs-delay="3000"
             >
                        <div class="toast-header">
                          <i class="bx bx-bell me-2"></i>
                          <div class="me-auto fw-semibold" id="toast-title"></div>
                        </div>
                        <div class="toast-body" id="toast-message">
                        </div>
    </div>
    
    
    <div class="page-content">
   <div class="py-5 border-bottom">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0"> 
          <li class="breadcrumb-item"><a href="@Url.Action("HomePage","HomePage")">Home</a></li>
          <li class="breadcrumb-item"><a href="@Url.Action("Cart","Cart")">Cart</a></li>
          <li class="breadcrumb-item active" aria-current="page">Checkout</li>
        </ol>
      </nav>
    </div>
   </div> 
	<section class="py-5">
					<div class="container">
						<div class="shop-cart">
							<div class="row">
								<div class="col-12 col-xl-8">
									<div class="checkout-payment">
										<div class="card bg-transparent rounded-0 shadow-none">
											<div class="card-body">
												<div class="steps steps-light">
													<a class="step-item active" href="@Url.Action("Cart","Cart")">
														<div class="step-progress"><span class="step-count">1</span>
														</div>
														<div class="step-label"><i class='bx bx-cart'></i>Cart</div>
													</a>
													<a class="step-item active" href="@Url.Action("Checkout","Checkout")">
														<div class="step-progress"><span class="step-count">2</span>
														</div>
														<div class="step-label"><i class='bx bx-user-circle'></i>Details</div>                                                        
													</a>
												
													<a class="step-item active current" href="@Url.Action("CheckoutPayment","Checkout",new{id=HttpContextAccessor.HttpContext.Session.GetString("UserId")})">
														<div class="step-progress"><span class="step-count">3</span>
														</div>
														<div class="step-label"><i class='bx bx-credit-card'></i>Payment</div>
													</a>

													<a class="step-item" href="@Url.Action("CheckoutReview","Checkout",new{id=HttpContextAccessor.HttpContext.Session.GetString("UserId")})">
														<div class="step-progress"><span class="step-count">4</span>
														</div>
														<div class="step-label"><i class='bx bx-check-circle'></i>Review</div>
													</a>
												</div>
											</div>
										</div>
										<div class="card rounded-0 shadow-none border">
											<div class="card-header border-bottom">
												<h2 class="h5 my-2">Choose Payment Method</h2>
											</div>
											<div class="card-body">
												<ul class="nav nav-pills mb-3 border p-3" role="tablist">
                                                @foreach(var payment in payment_methods)
                                                {
                                             if(payment.Paymentname=="Master Card")
                                                {
												<li class="nav-item" role="presentation">
														<a class="nav-link active rounded-0" data-bs-toggle="pill" href="#credit-card" role="tab" aria-selected="true">
															<div class="d-flex align-items-center">
																<div class="tab-icon"><i class='bx bx-credit-card font-18 me-1'></i>
																</div>
																<div class="tab-title">Credit Card</div>
															</div>
														</a>
													</li>
                                                 }
                                                @if(payment.Paymentname=="Paypal")
                                                {
													<li class="nav-item" role="presentation">
														<a class="nav-link rounded-0" data-bs-toggle="pill" href="#paypal-payment" role="tab" aria-selected="false">
															<div class="d-flex align-items-center">
																<div class="tab-icon"><i class='bx bxl-paypal font-18 me-1'></i>
																</div>
																<div class="tab-title">Paypal</div>
															</div>
														</a>
													</li>
                                                    }
													@* <li class="nav-item" role="presentation">
														<a class="nav-link rounded-0" data-bs-toggle="pill" href="#net-banking" role="tab" aria-selected="false">
															<div class="d-flex align-items-center">
																<div class="tab-icon"><i class='bx bx-mobile font-18 me-1'></i>
																</div>
																<div class="tab-title">Net Banking</div>
															</div>
														</a>
													</li> *@
                                                    }
												</ul>
												<div class="tab-content" id="pills-tabContent">
													<div class="tab-pane fade show active" id="credit-card" role="tabpanel">
														<div class="p-3 border">
															<form method="post" id="payment-method-form" asp-action="CheckoutReviewForm" asp-controller="Checkout">
																<div class="mb-3">
																	<label class="form-label">Card Owner</label>
																	<input type="text" class="form-control rounded-0" required name="card_owner" value="@card_owner" placeholder="Card Owner name">
                                                                   <div class="invalid-feedback">
                                                                Please enter card owner.
		                                                         </div>
																</div>
																<div class="mb-3">
																	<label class="form-label">Card number</label>
																	<div class="input-group">
																		<input type="text" class="form-control rounded-0" value="@card_number"  required name="card_number" placeholder="Valid Owner number">	<span class="input-group-text rounded-0"><img src="assets/images/icons/mastercard.png" width="35" alt=""></span>
																		<span class="input-group-text rounded-0"><img src="assets/images/icons/visa.png" width="35" alt=""></span>
																		<span class="input-group-text rounded-0"><img src="assets/images/icons/american-express.png" width="35" alt=""></span>
                                                                       <div class="invalid-feedback">
                                                                Please enter card number.
		                                                         </div>
																	</div>
																</div>
																<div class="row">
																	<div class="col-12 col-lg-8">
																		<div class="mb-3">
																			<label class="form-label">Expiration Date</label>
																			<div class="input-group">
																				<input type="text" class="form-control rounded-0" value="@mm" name="mm" required placeholder="MM">
																				<input type="text" class="form-control rounded-0" value="@yy" name="yy" required placeholder="YY">
                                                                               <div class="invalid-feedback">
                                                                Please enter card expiration date.
		                                                         </div>
																			</div>
																		</div>
																	</div>
																	<div class="col-12 col-lg-4">
																		<div class="mb-3">
																			<label class="form-label">CVV</label>
																			<input type="text" class="form-control rounded-0" value="@cvv" name="cvv" required placeholder="Three digit CCV number">
                                                                           <div class="invalid-feedback">
                                                                Please enter card cvv.
		                                                         </div>
																		</div>
																	</div>
																</div>
                                                                
																<div class="row">
																	<div class="col-md-12">
																		<div class="d-grid">	
                                                                            <input type="hidden" name="payment_method" value="Card">
																			<a href="#" id="confirm-btn-card" class="btn btn-dark btn-ecomm rounded-0">Confirm Payment</a>
																		</div>
																	</div>
																</div>
															</form>
														</div>
													</div>
													<div class="tab-pane fade" id="paypal-payment" role="tabpanel">
														<div class="p-3 border">
                                                            <form  method="post" id="payment-paypal-form" asp-action="CheckoutReviewForm" asp-controller="Checkout">
															<div class="mb-3">
																@* <div class="form-check form-check-inline">
																	<input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
																	<label class="form-check-label" for="inlineRadio1">Domestic</label>
																</div> *@
																<div class="form-check form-check-inline">
																	<input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" checked value="option2">
																	<label class="form-check-label" for="inlineRadio2">International</label>
																</div>
															</div>
                                                        	<div class="row">
																	<div class="col-md-12">
																		<div class="d-grid">	
                                                                           <input type="hidden" name="payment_method" value="Paypal">
																			<a href="#" id="confirm-btn-paypal" class="btn btn-dark btn-ecomm rounded-0">Confirm Payment</a>
																		</div>
																	</div>
																</div>
                                                                </form>
															@* <div class="mb-3">
																<div class="d-block">	<a href="javscript:;" class="btn btn-light rounded-0"><i class='bx bxl-paypal'></i>Login to my Paypal</a>
																</div>
															</div> *@
															@* <div class="mb-3">
																<p class="mb-0">Note: After clicking on the button, you will be directed to a secure gateway for payment. After completing the payment process, you will be redirected back to the website to view details of your order.</p>
															</div> *@
														</div>
													</div>
													<div class="tab-pane fade" id="net-banking" role="tabpanel">
														<div class="p-3 border">
															<div class="mb-3">
																<p>Select your Bank</p>
																<select class="form-select rounded-0" aria-label="Default select example">
																	<option selected>--Please Select Your Bank--</option>
																	<option value="1">Bank Name 1</option>
																	<option value="2">Bank Name 2</option>
																	<option value="3">Bank Name 3</option>
																</select>
															</div>
															<div class="mb-3">
																<div class="d-block"> <a href="javscript:;" class="btn btn-light rounded-0"><i class='bx bxl-paypal'></i>Login to my Paypal</a>
																</div>
															</div>
															<div class="mb-3">
																<p class="mb-0">Note: After clicking on the button, you will be directed to a secure gateway for payment. After completing the payment process, you will be redirected back to the website to view details of your order.</p>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
										<div class="card rounded-0 shadow-none border">
											<div class="card-body">
												<div class="row">
													<div class="col-md-6">
														<div class="d-grid">
															<a href="javascript:;" class="btn btn-light btn-ecomm"><i class="bx bx-chevron-left"></i>Back to Shipping</a>
														</div>
													</div>
													<div class="col-md-6">
														<div class="d-grid">
															<a href="javascript:;" class="btn btn-outline-dark btn-ecomm">Review Your Order<i class="bx bx-chevron-right"></i></a>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-12 col-xl-4">
									<div class="order-summary">
										<div class="card rounded-0">
											<div class="card-body">
												@* <div class="card rounded-0 border bg-transparent shadow-none mb-3">
													<div class="card-body">
														<p class="fs-5">Apply Discount Code</p>
														<div class="input-group">
															<input type="text" class="form-control rounded-0" placeholder="Enter discount code">
															<button class="btn btn-dark btn-ecomm" type="button">Apply</button>
														</div>
													</div>
												</div> *@
												<div class="card rounded-0 border bg-transparent shadow-none">
													<div class="card-body">
														<p class="fs-5">Order summary</p>
                                                    @foreach(var item in Model)
                                                    {
                                                    string regex_product=Regex.Replace(item.Product.ProductName, @"[^\w\d+,]", "-");

														<div class="my-3 border-top"></div>
														<div class="d-flex align-items-center">
												<a class="d-block flex-shrink-0" href="@Url.Action("ProductDetail","ProductDetail",new{product_name=regex_product})">
                        @if(item.Product.Backavatar.Contains("https") || item.Product.Backavatar.Contains("http"))
                          {
                          <img src="@item.Product.Backavatar" style="width:75px!important;" class="card-img-top" alt="...">
                          }
                          else
                          {
                            <img src="~/@item.Product.Backavatar.Substring(item.Product.Backavatar.IndexOf("wwwroot")+("wwwroot".Length+1))" style="width:75px!important;" class="card-img-top" alt="...">
                          }															</a>
															<div class="ps-2">
																<h6 class="mb-1"><a href="javascript:;" class="text-dark">@item.Product.ProductName</a></h6>
																<div class="widget-product-meta"><span class="me-2">@item.Price</span><span class="">x @item.Quantity</span>
																</div>
															</div>
														</div>
                                                        }
														@* <div class="my-3 border-top"></div>
														<div class="d-flex align-items-center">
															< a class="d-block flex-shrink-0" href="javascript:;">
																<img src="assets/images/products/17.png" width="75" alt="Product">
															</a>
															<div class="ps-2">
																<h6 class="mb-1"><a href="javascript:;" class="text-dark">Fancy Red Sneakers</a></h6>
																<div class="widget-product-meta"><span class="me-2">$16.<small>00</small></span><span class="">x 2</span>
																</div>
															</div>
														</div>
														<div class="my-3 border-top"></div>
														<div class="d-flex align-items-center">
															<a class="d-block flex-shrink-0" href="javascript:;">
																<img src="assets/images/products/04.png" width="75" alt="Product">
															</a>
															<div class="ps-2">
																<h6 class="mb-1"><a href="javascript:;" class="text-dark">Yellow Shine Blazer</a></h6>
																<div class="widget-product-meta"><span class="me-2">$22.<small>00</small></span><span class="">x 1</span>
																</div>
															</div>
														</div>
														<div class="my-3 border-top"></div>
														<div class="d-flex align-items-center">
															<a class="d-block flex-shrink-0" href="javascript:;">
																<img src="assets/images/products/09.png" width="75" alt="Product">
															</a>
															<div class="ps-2">
																<h6 class="mb-1"><a href="javascript:;" class="text-dark">Men Black Hat Cap</a></h6>
																<div class="widget-product-meta"><span class="me-2">$14.<small>00</small></span><span class="">x 1</span>
																</div>
															</div>
														</div> *@
													</div>
												</div>
												<div class="card rounded-0 border bg-transparent mb-0 shadow-none">
													<div class="card-body">
													<p class="mb-2">Subtotal: <span class="float-end">$@total_amount</span>
													</p>
														<p class="mb-2">Shipping:<span class="float-end">$@total_delivery</span>
													</p>
														<div class="my-3 border-top"></div>
														<h5 class="mb-0">Order Total: <span class="float-end">$@(total_amount+total_delivery)</span></h5>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
    </div>
  
  @* <div class="page-banner-area page-banner-height-2" data-background="@Url.Content("~/user_layout/img/banner/page-banner-4.jpg")">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="page-banner-content text-center">
                            <h4 class="breadcrumb-title">Thanh toán</h4>
                            <div class="breadcrumb-two">
                                <nav>
                                   <nav class="breadcrumb-trail breadcrumbs">
                                      <ul class="breadcrumb-menu">
                                         <li class="breadcrumb-trail">
                                            <a href="@Url.Action("HomePage","HomePage")"><span>Trang chủ</span></a>
                                         </li>
                                         <li class="trail-item">
                                            <span>Thanh toán</span>
                                         </li>
                                      </ul>
                                   </nav> 
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> *@

        @* <section class="coupon-area pt-120 pb-30">
            <div class="container">
            <div class="row">
            <div class="col-md-6">
                <div class="coupon-accordion">
                  @if(!(User.Identity.IsAuthenticated && User.IsInRole("User")))
                  {
                        <!-- ACCORDION START -->
                        <h3>Bạn đã có tài khoản?<span id="showlogin">Nhấn vào đây để đăng nhập
                        </span></h3>
                        <div id="checkout-login" class="coupon-content">
                        <div class="coupon-info">
                            <form id="signinForm" method="POST" asp-action="MyAccount" asp-controller="MyAccount">
                                    <p class="form-row-first">
                                    <label>Tên đăng nhập<span class="required">*</span></label>
                                    <input type="text" name="username" id="username" value="@(!string.IsNullOrEmpty(username)?username:"")">
                                    <span class="text-danger" id="username-error"></span><br>
                                    </p>
                                    <p class="form-row-last">
                                    <label>Mật khẩu<span class="required">*</span></label>
                                    <input type="password" name="password" id="password" value="@(!string.IsNullOrEmpty(password)?password:"")" autocomplete>
                                <span class="text-danger" id="password-error"></span><br>
                                    </p>
                                    <p class="form-row">
                                    <button class="tp-btn-h1" type="submit">Đăng nhập</button>
                                    <label>
                                    @if(saved_account!=null && saved_account)
                                    {
                                     <input type="checkbox" name="rememberme" value="true" checked>
                                     }
                                     else
                                     {
                                    <input type="checkbox" name="rememberme" value="true">
                                     }
                                     Nhớ mật khẩu
                                    </label>
                                    </p>
                                    <p class="lost-password">
                                    <a href="@Url.Action("ForgotPassword","MyAccount")">Quên mật khẩu?</a>
                                    </p>
                                    <div class="g-recaptcha mt-3" data-sitekey="@siteKey"></div>
                            </form>
                        </div>
                        </div>
                        }
                </div>
            </div>
          
            </div>
        </div>
        </section> *@
        <!-- coupon-area-end -->

        @* <!-- checkout-area-start -->
        <section class="checkout-area pb-85">
            <div class="container">
                <form id="checkout-form" method="POST" asp-action="CheckoutOrder" asp-controller="Checkout">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="checkbox-form">
                                <h3>Chi tiết thông tin</h3>
                                <div class="row">                                
                                    <div class="col-md-12">
                                        <div class="checkout-form-list">
                                            <label>Tên<span class="required">*</span></label>
                                            <input type="text" placeholder="Nhập tên" name="username" id="user-name" value="@(user!=null?user.UserName:"")" @(user!=null?"readonly":"")>
                                        <span class="text-danger" id="name-error"></span>
                                        <br>
                                        </div>
                                    </div>
                               
                                    <div class="col-md-12">
                                        <div class="checkout-form-list">
                                            <label>Địa chỉ<span class="required">*</span></label>                                            
                                            <input type="text" placeholder="Nhập địa chỉ giao hàng" id="address" name="address1" value="@(user!=null?!string.IsNullOrEmpty(user.Address2)?user.Address2:user.Address1:"")">
                                            <span class="text-danger" id="address-error"></span><br>                                            
                                        </div>
                                    </div>
                               
                                    <div class="col-md-6">
                                        <div class="checkout-form-list">
                                            <label>Email<span class="required">*</span></label>
                                            <input type="email" placeholder="Nhập Email của bạn" id="email" name="email" value="@(user!=null?user.Email:"")"  @(user!=null?"readonly":"")>      
                                            <span class="text-danger" id="email-error"></span><br>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="basic-login">
                                            <label>Số điện thoại<span class="required">*</span></label>
                                            <input type="number" placeholder="Nhập số điện thoại của bạn" id="phone" name="phonenumber" value="@(user!=null?user.PhoneNumber:"")"  @(user!=null?"readonly":"")>
                                        <span class="text-danger" id="phone-error"></span><br>
                                        </div>
                                    </div>
                               
                                </div>

                                <div class="different-address">
                                 
                                    <div class="order-notes">
                                        <div class="checkout-form-list">
                                            <label>Ghi chú đơn hàng</label>
                                            <textarea id="checkout-mess" name="note" cols="30" rows="10" placeholder="Các yêu cầu ghi chú khi giao hàng."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="your-order mb-30 ">
                                <h3>Đơn hàng của bạn</h3>
                                <div class="your-order-table table-responsive">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th class="product-name">Sản phẩm</th>
                                                <th class="product-total">Tổng cộng</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          @foreach(var item in Model)
                                          { 
                                          int discount=string.IsNullOrEmpty(item.Product.Discount.ToString()) ? 100 : Convert.ToInt32(item.Product.Discount);
                                          
                                          string price_value=!string.IsNullOrEmpty(item.Price) ? item.Price : item.Product.Price;

                                          total_value+=(Convert.ToInt32(price_value)-(Convert.ToInt32(price_value)*(discount)/100))*item.Quantity;
                                           
                                           string variant_info="";
                                           
                                           if(!string.IsNullOrEmpty(item.Size))
                                           {
                                            if(string.IsNullOrEmpty(variant_info))
                                            {
                                                variant_info+=item.Size;                                                                                                
                                            }
                                            else
                                            {
                                                variant_info+="/"+item.Size;
                                            }
                                           }
                                            if(!string.IsNullOrEmpty(item.Color))
                                           {
                                            if(string.IsNullOrEmpty(variant_info))
                                            {
                                                variant_info+=item.Color;
                                            }
                                            else
                                            {
                                                variant_info+="/"+item.Color;
                                            }
                                           }
                                        
                                   
                                        
                                            <tr class="cart_item">
                                                <td class="product-name">
                                                 @(item.Product.ProductName) <strong class="product-quantity"> ×&nbsp;@(item.Quantity)</strong><br>
                                                 <strong> @variant_info</strong>
                                                </td>
                                                <td class="product-total">
                                                    <span class="amount">@((Convert.ToInt32(price_value)-(Convert.ToInt32(price_value)*(discount)/100))*item.Quantity)</span>
                                                </td>
                                            </tr>
                                         
                                            }
                                        </tbody>
                                        <tfoot>
                                            <tr class="cart-subtotal">
                                                <th>Tạm tính</th>
                                                <td><span class="amount">@total_value VNĐ</span></td>
                                            </tr>
                                            <tr class="shipping">
                                                <th>Giao hàng</th>
                                                <td>
                                                    <ul>
                                                    
                                                            <input type="radio" name="shipping" checked>
                                                            <label>Miễn phí giao hàng:</label>
                                                        </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                            <tr class="order-total">
                                                <th>Tổng tiền đơn hàng</th>
                                                <td><strong><span class="amount">@total_value VNĐ</span></strong>
                                                </td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </form>
                                <div class="payment-method">
                            <div class="accordion" id="checkoutAccordion">
                                  
                                  @foreach(var payment in payment_methods)
                                 {    

                                     if(payment.Paymentname=="Delivery" && payment.Status==1)
                                    {
                                            <div class="accordion-item">
                                        <h2 class="accordion-header" id="delivery">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#deliver" aria-expanded="false" aria-controls="deliver">
                                            Thanh toán khi nhận hàng
                                            </button>
                                        </h2>
                                        <div id="deliver" class="accordion-collapse collapse" aria-labelledby="delivery" data-bs-parent="#checkoutAccordion">
                                            <div class="accordion-body">
                                            
                                            <p><span style="color: red;">*</span>
                                            Quý khách vui lòng kiểm tra kỹ thông tin đơn hàng trước khi nhận hàng.Đơn hàng của quý khách sẽ được giao đến địa chỉ đã đăng ký trong vòng 1-2 ngày làm việc kể từ khi đặt hàng.
                                             </p>
                                            </div>
                                        </div>
                                    </div>
                                    }

                                    if(payment.Paymentname=="Bank" && payment.Status==1)
                                    {
                                     <div class="accordion-item">
                                        <h2 class="accordion-header" id="checkoutOne">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#bankOne" aria-expanded="true" aria-controls="bankOne">
                                            Thanh toán qua ngân hàng
                                            </button>
                                        </h2>
                                        <div id="bankOne" class="accordion-collapse collapse show" aria-labelledby="checkoutOne" data-bs-parent="#checkoutAccordion">
                                            <div class="accordion-body">
                                             <p><span style="color: red;">*</span>Quý khách thanh toán qua tài khoản sau.Đơn hàng của quý khách sẽ không được giải quyết cho đến khi việc xác nhận chuyển khoản được thực hiện thành công.Sau 3 ngày kể từ lúc đặt hàng,nếu hệ thống kiểm tra và xác nhận đơn hàng vẫn chưa được 
                                                chuyển khoản thì hệ thống sẽ tự động hủy đơn hàng.
                                             </p>
                                            <div class="qr-payment">
      <div class="qr-info">
        <h3>Thông tin ngân hàng:</h3>
        <ul>
          <li><strong>Số tiền cần chuyển:</strong>&nbsp;@total_value VNĐ</li>
          <li><strong>Tên ngân hàng:</strong>&nbsp;@bank_name</li>
          <li><strong>Tên chủ thể:</strong>&nbsp;@account_name</li>
          <li><strong>Số tài khoản:</strong>&nbsp;@account_num</li>
          <li><strong>Nội dung:</strong>&nbsp;"#(Mã đơn hàng) chuyển khoản" Vd:#100101 chuyển khoản</li>
        </ul>
      </div>
      <div class="qr-code">
        <img class="qr-img" src="@qr_code" alt="QR Code">
      </div>
    </div>                                           
                                            </div>
                                        </div>
                                    </div>
                                    }
                                  
                                    if(payment.Paymentname=="Paypal" && payment.Status==1)
                                    {
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="paypalThree">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#paypal" aria-expanded="false" aria-controls="paypal">
                                            Thanh toán qua Paypal
                                            </button>
                                        </h2>
      <div id="paypal" class="accordion-collapse collapse" aria-labelledby="paypalThree" data-bs-parent="#checkoutAccordion">
          <div class="accordion-body">
      <div class="payment-method">
     
          <h3>Thanh toán sử dụng Paypal</h3>
        <div class="credit-card-form">
            <div id="paypal-button-container" class="text-center"></div>
   
        </div>
      </div>
                                            </div>
                                        </div>
                                    </div>
        }
                     if(payment.Paymentname=="Master Card" && payment.Status==1)
                                    {
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="paypalThree">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#visa" aria-expanded="false" aria-controls="visa">
                                            Thanh toán qua Visa Card                                            
                                            </button>
                                        </h2>
                                        <div id="visa" class="accordion-collapse collapse" aria-labelledby="paypalThree" data-bs-parent="#checkoutAccordion">
          <div class="accordion-body">
      <div class="payment-method">
        <div class="visa-logo">
          <img src="@Url.Content("~/user_layout/img/banner/card.png")" alt="Visa Logo"> 
        </div>
          <h3>Thanh toán sử dụng Visa Card</h3>          
        <div class="credit-card-form">
          <div class="form-group">
            <label for="card-holder"><strong>Tên chủ thể thẻ</strong></label>
            <input type="text" id="card-holder" name="card-holder" placeholder="John Doe">
          </div>
          <div class="form-group">
            <label for="card-number"><strong>Số tài khoản</strong></label>
            <input type="text" id="card-number" name="card-number" placeholder="1234 5678 9012 3456">
          </div>
          <div class="form-group-grouped">
            <div class="form-group">
              <label for="expiry-date"><strong>Ngày hết hạn</strong></label>
              <input type="text" id="expiry-date" name="expiry-date" placeholder="MM/YY">
            </div>
            <div class="form-group">
              <label for="cvv"><strong>CVV</strong></label>
              <input type="text" id="cvv" name="cvv" placeholder="123">
            </div>
          </div>
        </div>
      </div>
      <button type="button" class="pay-button">Thanh toán</button>
                                            </div>
                                        </div>
                                    </div>
        }
                                    }
                                    </div>
                                    <div class="order-button-payment mt-20">
                                    <button type="button" id="checkout-order-btn" class="tp-btn-h1">Tiến hành đặt hàng</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </section> *@


<script src="https://www.paypal.com/sdk/js?client-id=@paypal_client_id" data-namespace="paypal_sdk"></script>


<script>

  document.addEventListener("DOMContentLoaded",()=>
  {
  var confirmCardBtn = document.getElementById("confirm-btn-card");
  var confirmPaypalBtn = document.getElementById("confirm-btn-paypal");

  confirmCardBtn.addEventListener("click", (e) => {
   e.preventDefault();

    let isValid = true;

    var formCard = document.getElementById("payment-method-form");
    
    var input =document.querySelectorAll("input[required]");

    input.forEach((item)=>
    {
        if(item.value.trim() === "")
        {
            item.classList.add("is-invalid");

            isValid=false;
        }
        else
        {
            item.classList.remove("is-invalid");
        }
    });
    
    if(isValid)
    {
        formCard.submit();
    }
  });
     
confirmPaypalBtn.addEventListener("click",(e)=>
{ 
  e.preventDefault();
  
  var formPaypal=document.getElementById("payment-paypal-form");
  
  formPaypal.submit();
});

});


</script>
      